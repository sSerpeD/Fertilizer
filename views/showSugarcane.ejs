<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link href="./css/style.css" type="text/css" rel="stylesheet" >
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <title>คำนวณปุ๋ย</title>
</head>
<body>
  <div class="cage">
    <div class="bg-white border border-dark">
      <div class="order text-center bg-white">
        <div class="row">
          <div class="col-sm border p-1 border-dark bg-secondary">
            ขั้นตอนที่ 1
          </div>
          <div class="col-sm border p-1 border-dark bg-secondary">
            ขั้นตอนที่ 2
          </div>
          <div class="col-sm border p-1 border-dark bg-secondary">
            ขั้นตอนที่ 3
          </div>
          <div class="col-sm border p-1 border-dark" style="background-color: rgb(235, 128, 46);">
            ขั้นตอนที่ 4
          </div>
        </div>
    </div>
    <div class="container">
      <br>
      <h3 class="text-center">คำแนะนำ</h3>
      <br>
      <% if(pH<5.6){ %>
        <p>ค่าความเป็นกรด &emsp; pH <%= pH %> &ensp; คำแนะนำ <label class="bg-warning">ดินเป็นกรด-ควรใส่ปูนขาวหรือวัสดุปูน อัตรา50กก./ไร่ โดยโรยข้างแถวแล้วกลบ</label></p>
      <% }else if(pH>=5.6 && pH<=7.3){ %>
        <p>ค่าความเป็นกรด &emsp; pH <%= pH %> &ensp; คำแนะนำ <label class="bg-success">ความเป็นกรด-ด่าง เหมาะสม</label></p>
      <% }else{ %>
        <p>ค่าความเป็นกรด &emsp; pH <%= pH %> &ensp; คำแนะนำ <label class="bg-warning">ดินด่างแนะนำให้ใช้ปุ๋ย 21-0-0</label></p>
      <% } %>
      <p>คำแนะนำปุ๋ยตามค่าวิเคราะห์ดิน</p>
      <div class="container">
        <div class="text-center">
          <label>คำแนะนำ</label>
          <div class="row text-center">
            <div class="col" style="width: 25%;"></div>
            <div class="col border border-1 red" style="width: 25%;">N</div>
            <div class="col border border-1 green" style="width: 25%;">P2O5</div>
            <div class="col border border-1 yellow" style="width: 25%;">K2O</div>
          </div>
          <div class="row text-center">
            <div class="col">
              ปุ๋ยตามค่าวิเคราะห์ดิน
            </div>
            <div class="col border red">
              <% const N = oM < 0.75 ? 27 : oM < 1.5 ? 15 : oM < 2.25 ? 12 : 6 %>
              <%- N %>
            </div>
            <div class="col border green">
              <% const P2O5 = P < 7 ? 9 : P < 15 ? 6 : P < 30 ? 6 : 3 %>
              <%- P2O5 %>
            </div>
            <div class="col border yellow">
              <% const K2O = K < 30 ? 18 : K < 60 ? 18 : K < 90 ? 12 : 6 %>
              <%- K2O %>
            </div>
          </div>
        </div>

        <br>
        <% if(!check){ %>
          <div class="text-center">
            <div class="row text-center">
              <div class="col" style="width: 25%;"></div>
              <div class="col border border-1 red" style="width: 25%;">N</div>
              <div class="col border border-1 green" style="width: 25%;">P2O5</div>
              <div class="col border border-1 yellow" style="width: 25%;">K2O</div>
            </div>
            <div class="row text-center">
              <div class="col">
                แบ่งใส่ปุ๋ยพร้อมปลูก
              </div>
              <div class="col border red">
                <%- N/2 %>
              </div>
              <div class="col border green">
                <%- P2O5 %>
              </div>
              <div class="col border yellow">
                <%- K2O %>
              </div>
            </div>
          </div>
        <% } %>
        <br>

        <div class="container flex green" style="border-radius: 10px;">
          <div class="card border border-0 green" style="width: 22rem;">
            <br>
            <% if(!check){ %>
              <p class="bg-warning text-center">ครั้งที่ 1</p>
            <% } %>
            <p class="text-center">การเตรียมปุ๋ยจาก</p>
            <div class="container text-center" style="width: 50%;">
              <div class="row yellow">
                
                <div class="w-100"></div>
                
                <div class="col text-danger border"><%= Number(nn) %></div>
                <div class="col text-danger border"><%= Number(np) %></div>
                <div class="col text-danger border"><%= Number(nk) %></div>
                <div class="w-100"></div>
                
                <div class="col text-danger border"><%= Number(pn) %></div>
                <div class="col text-danger border"><%= Number(pp) %></div>
                <div class="col text-danger border"><%= Number(pk) %></div>
                <div class="w-100"></div>
                
                <div class="col text-danger border"><%= Number(kn) %></div>
                <div class="col text-danger border"><%= Number(kp) %></div>
                <div class="col text-danger border"><%= Number(kk) %></div>
              </div>
            </div>
          </div>
          
          <div class="card border border-0 green" style="width: 22rem;">
            <br>
            <p class="text-center">การชั่งปุ๋ย</p>
            <p class="text-center">พื้นที่&emsp;<%= rai %> ไร่ <%= ngan %> งาน <%= squareWa %> ตารางวา</p>
            <div class="container text-center" style="width: 50%;">
              <div class="row" style="background-color: white;">
                
                <div class="col text-black border">กก./ไร่</div>
                <div class="col text-black border">แปลง</div>
                <div class="w-100"></div>

                <div class="col text-success border">
                  
                  <% const pRai = P2O5*100/pp < 0 ? "ปุ๋ยเกิน" : parseFloat(P2O5*100/pp).toFixed() %>
                  <% const nRai = (N/2)-(pRai*pn)/100 < 0 ? "ปุ๋ยเกิน" : parseFloat(((N/2)-(pRai*pn)/100)*100/pp).toFixed() %>
                  <% const checkP = ((P2O5-(ferN*ferP/100))*100)/pp < 0 ? "ปุ๋ยเกิน" : parseFloat(((P2O5-(ferRai*ferP/100))*100)/pp).toFixed() %>
                  <% const checkN = N-(ferRai*ferN/100)-(checkP*pn/100) < 0 ? "ปุ๋ยเกิน" : parseFloat((N-(ferRai*ferN/100)-(checkP*pn/100))*100/nn).toFixed() %>

                  <% if(!check){ %>
                    <%= nRai %>
                  <% }else{ %>
                    <%= checkN %>
                  <% } %>

                </div>
                <div class="col text-black border">
                  
                  <% const plot1 = nRai == "ปุ๋ยเกิน" ? "ปุ๋ยเกิน" : parseFloat(nRai*(Number(rai)+(ngan*0.25)+(squareWa/400))).toFixed() %>
                  <% const plotN = nRai == "ปุ๋ยเกิน" ? "ปุ๋ยเกิน" : parseFloat(checkN*(Number(rai)+(ngan*0.25)+(squareWa/400))).toFixed() %>
                  
                  <% if(!check){ %>
                    <%- plot1 %>
                  <% }else{ %>
                    <%= plotN %>
                  <% } %>

                </div>
                <div class="w-100"></div>
                
                <div class="col text-success border">

                  <% if(!check){ %>
                    <%= pRai %>
                  <% }else{ %>
                    <%= checkP %>
                  <% } %>

                </div>
                <div class="col text-black border">

                  <% const plot2 = pRai == "ปุ๋ยเกิน" ? "ปุ๋ยเกิน" : parseFloat(pRai*(Number(rai)+(ngan*0.25)+(squareWa/400))).toFixed() %>
                  <% const plotP = checkP == "ปุ๋ยเกิน" ? "ปุ๋ยเกิน" : parseFloat(checkP*(Number(rai)+(ngan*0.25)+(squareWa/400))).toFixed() %>
                  
                  <% if(!check){ %>
                    <%- plot2 %>
                  <% }else{ %>
                    <%= plotP %>
                  <% } %>
                
                </div>
                <div class="w-100"></div>
                
                <div class="col text-success border">
                  <% var kRai = parseFloat((K2O-pRai*(pk/100))*100/kk).toFixed() %>
                  <% const checkK = (K2O-(ferRai*ferK/100)-(checkP*pk/100))*100/kk < 0 ? "ปุ๋ยเกิน" : parseFloat((K2O-(ferRai*ferK/100)-(checkP*pk/100))*100/kk).toFixed() %>
                  
                  <% if(!check){ %>
                    <%- kRai %>
                  <% }else{ %>
                    <%= checkK %>
                  <% } %>
                  
                </div>
                <div class="col text-black border">

                  <% const plot3 = kRai == "ปุ๋ยเกิน" ? "ปุ๋ยเกิน" : parseFloat(kRai*(Number(rai)+(ngan*0.25)+(squareWa/400))).toFixed() %>
                  <% const plotK = checkK == "ปุ๋ยเกิน" ? "ปุ๋ยเกิน" : parseFloat(checkK*(Number(rai)+(ngan*0.25)+(squareWa/400))).toFixed() %>
                  
                  <% if(!check){ %>
                    <%- plot3 %>
                  <% }else{ %>
                    <%= plotK %>
                  <% } %>
                
                </div>
              </div>
              <br>
            </div>
          </div> 
          </div>

        </div>

        <% if(!check){ %>
          <div class="container flex red" style="border-radius: 10px;">
            <div class="card border border-0 red" style="width: 22rem;">
              <br>
              <p class="bg-warning text-center">ครั้งที่ 2</p>
              <p class="text-center">การเตรียมปุ๋ยจาก</p>
              <div class="container text-center" style="width: 50%;">
                <div class="row yellow">
                  
                  <div class="w-100"></div>
                  
                  <div class="col text-danger border"><%= Number(nn) %></div>
                  <div class="col text-danger border"><%= Number(np) %></div>
                  <div class="col text-danger border"><%= Number(nk) %></div>
                  <div class="w-100"></div>
                  
                  <div class="col text-danger border"><%= Number(pn) %></div>
                  <div class="col text-danger border"><%= Number(pp) %></div>
                  <div class="col text-danger border"><%= Number(pk) %></div>
                  <div class="w-100"></div>
                  
                  <div class="col text-danger border"><%= Number(kn) %></div>
                  <div class="col text-danger border"><%= Number(kp) %></div>
                  <div class="col text-danger border"><%= Number(kk) %></div>
                </div>
              </div>
            </div>
            
            <div class="card border border-0 red" style="width: 22rem;">
              <br>
              <p class="text-center">การชั่งปุ๋ย</p>
              <p class="text-center">พื้นที่&emsp;<%= rai %> ไร่ <%= ngan %> งาน <%= squareWa %> ตารางวา</p>
              <div class="container text-center" style="width: 50%;">
                <div class="row bg-white">
                  
                  <div class="col text-black border">กก./ไร่</div>
                  <div class="col text-black border">แปลง</div>
                  <div class="w-100"></div>
  
                  <div class="col text-success border">

                    <% const nRai2 = (pRai*pn/100) > N ? "ปุ๋ยเกิน" : ((N/2)-(pRai*pn)/100) < 0 ? (N/2)-((-1)*((N/2)-(pRai*pn)/100)) : (N/2)*100/nn %>
                    <%- parseFloat(nRai2).toFixed() %>
                  
                  </div>
                  <div class="col text-black border">

                    <% const plot2_1 = nRai2 == "ปุ๋ยเกิน" ? "ปุ๋ยเกิน" : parseFloat(nRai2*(Number(rai)+(ngan*0.25)+(squareWa/400))).toFixed() %>
                    <%- plot2_1 %>

                  </div>
                  <div class="w-100"></div>
                  
                  <div class="col text-success border">
                    -
                  </div>
                  <div class="col text-black border">
                    
                  </div>
                  <div class="w-100"></div>
                  
                  <div class="col text-success border">
                    -
                  </div>
                  <div class="col text-black border">
                    
                  </div>
                </div>
                <br>
              </div>
            </div> 
          </div>
        <% } %>

        <% var sum1 = plot1*(price1/50) %>
        <% var sum2 = plot2*(price2/50) %>
        <% var sum3 = plot3*(price3/50) %>
        <% var sumAll = sum1+sum2+sum3 %>
        <% const checkSum1 = parseFloat(plotN*(price1/50)).toFixed() %>
        <% const checkSum2 = parseFloat(plotP*(price2/50)).toFixed() %>
        <% const checkSum3 = parseFloat(plotK*(price3/50)).toFixed() %>
        <% const checkSumAll = Number(checkSum1)+Number(checkSum2)+Number(checkSum3) %>
        <% const nRai2 = (pRai*pn/100) > N ? "ปุ๋ยเกิน" : ((N/2)-(pRai*pn)/100) < 0 ? (N/2)-((-1)*((N/2)-(pRai*pn)/100)) : (N/2)*100/nn %>
        <% const plot2_1 = nRai2 == "ปุ๋ยเกิน" ? "ปุ๋ยเกิน" : parseFloat(nRai2*(Number(rai)+(ngan*0.25)+(squareWa/400))).toFixed() %>
        <% var sum2_1 = plot2_1*(price1/50) %>
        <% var sumAll2 = sum2_1 %>

        <div class="container flex">
          <div class="card border border-dark" style="width: 20rem;">
            <div class="card-body">
              <p class="">รวมพื้นที่&emsp;<%= rai %> ไร่ <%= ngan %> งาน <%= squareWa %> ตารางวา</p>
              <p>จ่ายค่าปุ๋ย</p>
              <div class="text-center">
                <p class=""><%= ferN %> - <%= ferP %> - <%= ferK %>&emsp;เป็นเงิน&emsp;
                  <%- ferCal %>
                </p>
                <p class=""><%= nn %> - <%= np %> - <%= nk %>&emsp;เป็นเงิน&emsp;
                  <% if(!check){ %>
                    <%= Number(sum1) + Number(sum2_1) %>
                  <% }else{ %>
                    <%- checkSum1 %>
                  <% } %>
                </p>
                <p class=""><%= pn %> - <%= pp %> - <%= pk %>&emsp;เป็นเงิน&emsp;
                  <% if(!check){ %>
                    <%= Number(sum2) %>
                  <% }else{ %>
                    <%- checkSum2 %>
                  <% } %>
                </p>
                <p class=""><%= kn %> - <%= kp %> - <%= kk %>&emsp;เป็นเงิน&emsp;
                  <% if(!check){ %>
                    <%= Number(sum3) %>
                  <% }else{ %>
                    <%- checkSum3 %>
                  <% } %>
                </p>
                <p>รวมเป็นเงิน 
                  <% if(!check){ %>
                    <%= Number(sum1)+Number(sum2_1)+Number(sum2)+Number(sum3) %>
                  <% }else{ %>
                    <%- Number(checkSumAll)+Number(ferCal) %>
                  <% } %>
                </p>
                <p>
                  
                  <% if(!check){ %>
                    <%- parseFloat((Number(sum1)+Number(sum2_1)+Number(sum2)+Number(sum3))/(Number(rai)+(ngan*0.25)+(squareWa/400))).toFixed() %> 
                    <% }else{ %>
                    <%- (checkSumAll+Number(ferCal))/(Number(rai)+(ngan*0.25)+(squareWa/400)) %>
                  <% } %>
                  
                  บาทต่อไร่</p>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div style="display: flex; justify-content: center;">
        <button onclick="goBack()" type="button" class="btn btn-lg rounded" style="background-color: rgb(242, 187, 46); margin-right: 0.5em;">
          <a style="text-decoration: none; color: rgb(33, 33, 33);"> <- ย้อนกลับ </a>
        </button>
        <script>
          function goBack() {
            window.history.back();
          }
        </script>
      
        <button type="button" class="btn btn-lg rounded" style="background-color: #2e9df2; margin-left: 0.5em; margin-right: 0.5em;">
          <a href="/"  style="text-decoration: none; color: rgb(33, 33, 33);"> หน้าแรก </a>
        </button>
  
        <button type="button" class="btn btn-lg rounded" style="background-color: rgb(242, 187, 46); margin-left: 0.5em;">
          <a href="/sugarcane" style="text-decoration: none; color: rgb(33, 33, 33);"> ต่อไป -> </a>
        </button>
      </div>
      <br>
    </div>
  </div>
</body>

</html>